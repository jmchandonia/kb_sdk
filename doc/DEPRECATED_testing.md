# KBase SDK - Module Testing Framework

Test files and scripts go in the `test` directory of your module.  To run tests locally, you must have Docker installed on your machine (see (doc/installation.md)[doc/installation.md] and have the Docker daemon running.

Tests are invoked from either the base directory of your module or the `test_local` directory.  The test_local directory contains a small autogenerated script to build and run the Docker image and a test config file.  The test_local directory should not be committed to GitHub because it will include your GitHub username and password.

If the `test_local` directory does not exist yet (likely because you cloned the repo rather than creating it directly with the SDK), then run `kb-sdk test` in the base directory of your module to generate it.

To run tests, first edit the test_local/test.cfg file to add your kbase username and password.

Then:

    cd test_local
    kb-sdk test

Code that generates temporary files should write them to the directory indicated by the `scratch` configuration variable.  (This is the same configuration that, for instance, is used to give you the Workspace URL).  In tests, this scratch area is automatically mounted on your local system to the `test_local/workdir` directory, so you can easily access any files created by your method.  This is useful in debugging your module.

To add additional tests, edit the code/files in the `test` directory.  For Python, for instance, you can add additional tests to the ModuleName_server_test.py script using Python's standard unittest module.  The test runner (run_tests.sh) is configured to pick up and run any test files in the test directory that end in `test.py`.  Of course, you can modify the test runner script or any other test files to suit your particular module needs.




#### Some tips

If running on a Mac, you may get this error:

    readlink: illegal option -- f
    usage: readlink [-n] [file ...]

This occurs because the readlink methods on Mac and Linux are different.  There are several ways to solve this problem--see this [stackoverflow thread](http://stackoverflow.com/questions/1055671/how-can-i-get-the-behavior-of-gnus-readlink-f-on-a-mac).  A simple way is to install greadlink in coreutils, for instance with brew:

    brew install coreutils

and edit the `test_local/build_run_tests.sh` script by adding a 'g' before 'readlink' in the second line.

Note that writing named pipes (e.g., with `mkfifo`) does not seem to work in the scratch directory when running on Docker on a Mac through VirtualBox.  This is an issue with the VirtualBox/Mac mount, and we do not have a good workaround.  If you encounter this issue, you can try to either create any named pipes directly in the Docker image filesystem, which works, or develop natively on Linux (or directly in a VirtualBox instance running Linux).
